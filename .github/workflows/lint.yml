# =============================================================================
# Lint Workflow â€” Fast fmt + clippy gate on every push/PR
#
# This is the only automatic workflow that runs on code changes.
# Full builds are available via the manual Build or CI workflows.
# =============================================================================
name: Lint

on:
  push:
    branches: [main]
    paths-ignore:
      - '**/*.md'
      - 'docs/**'
      - 'LICENSE'
      - '.gitignore'
      - 'PLAN*.md'
      - 'REPORT*.md'
      - 'adrs/**'
      - 'plans/**'
      - 'coverage/**'
      - 'cnpg/**'
      - 'scripts/**'
  pull_request:
    branches: [main]
    paths-ignore:
      - '**/*.md'
      - 'docs/**'
      - 'LICENSE'
      - '.gitignore'
      - 'PLAN*.md'
      - 'REPORT*.md'
      - 'adrs/**'
      - 'plans/**'
      - 'coverage/**'
      - 'cnpg/**'
      - 'scripts/**'

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  CARGO_TERM_COLOR: always
  PG_VERSION: "18"

jobs:
  lint:
    name: Lint (fmt + clippy)
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v4

      - name: Setup pgrx environment
        uses: ./.github/actions/setup-pgrx

      - name: Check formatting
        run: cargo fmt -- --check

      - name: Run clippy
        run: cargo clippy --all-targets --features pg18 -- -D warnings
